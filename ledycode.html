<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Ejercicios: Tuberías en Serie</title>
        <style>
            body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding: 24px; background: #f7f9fc; color: #0f172a }
            .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 6px 18px rgba(12,20,45,0.08) }
            h1 { margin-top: 0 }
            .exercise { display: none; }
            .exercise.active { display: block; }
            .controls { margin-top: 12px; display:flex; gap:8px; align-items:center }
            .feedback { margin-top:8px; font-weight:600 }
            .feedback.error { color: #b91c1c }
            .feedback.success { color: #0f9d58 }
            input[type="text"], textarea { width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1 }
            button { padding:8px 12px; border-radius:6px; border:0; cursor:pointer }
            button.primary { background:#2563eb; color:white }
            button.secondary { background:#94a3b8; color:white }
            .solution { margin-top:10px; background:#f1f5f9; padding:10px; border-radius:6px; font-family: monospace }
            .nav { display:flex; gap:8px; margin-top:16px }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Ejercicios: Tuberías en Serie</h1>
            <p>Responde las preguntas en los cuadros de texto. Si tu respuesta es incorrecta, verás retroalimentación y la solución. Si es correcta, verás "Correcto" en verde y pasarás al siguiente ejercicio.</p>

            <div id="exercises">
                <!-- Ejercicio 1 -->
                <section class="exercise active" data-index="0" id="ex-0">
                    <h2>Ejercicio 1</h2>
                    <p>Dos tuberías en serie, la primera tiene un caudal Q1 = 5 L/s y la pérdida de carga h1 = 2 m. La segunda tiene pérdida h2 = 3 m. ¿Cuál es la pérdida de carga total h_total?</p>
                    <label for="ans-0">Respuesta (m):</label>
                    <input type="text" id="ans-0" placeholder="Escribe la respuesta numérica">
                    <div class="controls">
                        <button class="primary" data-action="check">Comprobar</button>
                        <button class="secondary" data-action="show-solution">Mostrar solución</button>
                    </div>
                    <div class="feedback" id="fb-0" aria-live="polite"></div>
                    <div class="solution" id="sol-0" style="display:none"></div>
                </section>

                <!-- Ejercicio 2 -->
                <section class="exercise" data-index="1" id="ex-1">
                    <h2>Ejercicio 2</h2>
                    <p>En una serie de tuberías, si las pérdidas son h1 = 1.5 m, h2 = 2.5 m y h3 = 0.5 m, ¿cuál es la pérdida total?</p>
                    <label for="ans-1">Respuesta (m):</label>
                    <input type="text" id="ans-1" placeholder="Escribe la respuesta numérica">
                    <div class="controls">
                        <button class="primary" data-action="check">Comprobar</button>
                        <button class="secondary" data-action="show-solution">Mostrar solución</button>
                    </div>
                    <div class="feedback" id="fb-1" aria-live="polite"></div>
                    <div class="solution" id="sol-1" style="display:none"></div>
                </section>

                <!-- Ejercicio 3 -->
                <section class="exercise" data-index="2" id="ex-2">
                    <h2>Ejercicio 3</h2>
                    <p>Dos tuberías iguales en serie tienen pérdidas h_each = 4 m cada una. ¿Cuál es la pérdida total?</p>
                    <label for="ans-2">Respuesta (m):</label>
                    <input type="text" id="ans-2" placeholder="Escribe la respuesta numérica">
                    <div class="controls">
                        <button class="primary" data-action="check">Comprobar</button>
                        <button class="secondary" data-action="show-solution">Mostrar solución</button>
                    </div>
                    <div class="feedback" id="fb-2" aria-live="polite"></div>
                    <div class="solution" id="sol-2" style="display:none"></div>
                </section>
            </div>

            <div class="nav">
                <button id="prev">Anterior</button>
                <button id="next">Siguiente</button>
                <div style="flex:1"></div>
                <button id="reset">Reiniciar</button>
            </div>
        </div>

        <script>
            // Datos de respuestas y soluciones
            const problems = [
                { answer: 5, solution: 'Suma simple: h_total = h1 + h2 = 2 + 3 = 5 m' },
                { answer: 4.5, solution: 'h_total = 1.5 + 2.5 + 0.5 = 4.5 m' },
                { answer: 8, solution: 'h_total = 4 + 4 = 8 m' }
            ];

            let current = 0;
            const exerciseEls = document.querySelectorAll('.exercise');

            function showExercise(index) {
                exerciseEls.forEach((el,i) => {
                    el.classList.toggle('active', i === index);
                });
                current = index;
            }

            document.getElementById('prev').addEventListener('click', () => {
                const nextIdx = Math.max(0, current - 1);
                showExercise(nextIdx);
            });

            document.getElementById('next').addEventListener('click', () => {
                const nextIdx = Math.min(exerciseEls.length - 1, current + 1);
                showExercise(nextIdx);
            });

            document.getElementById('reset').addEventListener('click', () => {
                exerciseEls.forEach((el,i) => {
                    document.getElementById('ans-' + i).value = '';
                    document.getElementById('fb-' + i).textContent = '';
                    document.getElementById('fb-' + i).className = 'feedback';
                    document.getElementById('sol-' + i).style.display = 'none';
                });
                showExercise(0);
            });

            // Delegación de eventos para botones dentro de ejercicios
            document.getElementById('exercises').addEventListener('click', (e) => {
                const action = e.target.getAttribute('data-action');
                if (!action) return;
                const section = e.target.closest('.exercise');
                const idx = Number(section.getAttribute('data-index'));

                if (action === 'check') {
                    checkAnswer(idx);
                } else if (action === 'show-solution') {
                    showSolution(idx);
                }
            });

            function normalizeNumberInput(val) {
                if (val === null || val === undefined) return NaN;
                // Reemplaza comas por puntos y elimina espacios
                const cleaned = String(val).trim().replace(',', '.');
                return Number(cleaned);
            }

            function checkAnswer(i) {
                const input = document.getElementById('ans-' + i);
                const fb = document.getElementById('fb-' + i);
                const sol = document.getElementById('sol-' + i);
                const userVal = normalizeNumberInput(input.value);
                const correct = problems[i].answer;

                if (Number.isNaN(userVal)) {
                    fb.textContent = 'Por favor ingresa un número válido.';
                    fb.className = 'feedback error';
                    sol.style.display = 'none';
                    return;
                }

                // Aceptar pequeñas diferencias por formato (tolerancia)
                const tol = 1e-6;
                if (Math.abs(userVal - correct) <= tol) {
                    fb.textContent = 'Correcto ✅';
                    fb.className = 'feedback success';
                    sol.style.display = 'none';
                    // Avanzar al siguiente ejercicio después de una corta pausa
                    setTimeout(() => {
                        const nextIdx = Math.min(exerciseEls.length - 1, i + 1);
                        showExercise(nextIdx);
                    }, 700);
                } else {
                    fb.textContent = 'Incorrecto ❌';
                    fb.className = 'feedback error';
                    sol.textContent = problems[i].solution + ' (Respuesta correcta: ' + correct + ' m)';
                    sol.style.display = 'block';
                }
            }

            function showSolution(i) {
                const sol = document.getElementById('sol-' + i);
                sol.textContent = problems[i].solution + ' (Respuesta correcta: ' + problems[i].answer + ' m)';
                sol.style.display = 'block';
                const fb = document.getElementById('fb-' + i);
                fb.textContent = 'Se mostró la solución.';
                fb.className = 'feedback';
            }

            // Inicializar soluciones vacías
            problems.forEach((p, i) => {
                const sol = document.getElementById('sol-' + i);
                sol.textContent = '';
            });
        </script>
    </body>
</html>