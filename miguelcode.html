<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ejercicios: Tuber√≠as en Serie</title>
    <style>
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            padding: 24px;
            background: #f7f9fc;
            color: #0f172a
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(12,20,45,0.08)
        }

        h1 {
            margin-top: 0
        }

        .exercise {
            display: none;
        }

        .exercise.active {
            display: block;
        }

        .controls {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            align-items: center
        }

        .feedback {
            margin-top: 8px;
            font-weight: 600
        }

        .feedback.error {
            color: #b91c1c
        }

        .feedback.success {
            color: #0f9d58
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #cbd5e1
        }

        button {
            padding: 8px 12px;
            border-radius: 6px;
            border: 0;
            cursor: pointer
        }

        button.primary {
            background: #2563eb;
            color: white
        }

        button.secondary {
            background: #94a3b8;
            color: white
        }

        .solution {
            margin-top: 10px;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace
        }

        .nav {
            display: flex;
            gap: 8px;
            margin-top: 16px
        }

        .retroalimentacion {
            background: #f1f5f9;
            border-left: 4px solid #2563eb;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .retroalimentacion h3 {
            margin-top: 0;
            color: #1e3a8a
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ejercicios: Tuber√≠as en Serie</h1>
        <p>Responde las preguntas en los cuadros de texto. Si tu respuesta es correcta, ver√°s la retroalimentaci√≥n con el proceso completo.</p>

        <div id="exercises">

            <!-- Ejercicio 1 -->
            <section class="exercise active" data-index="0" id="ex-0">
                <h2>Ejercicio 1</h2>
                <p>Para el sistema mostrado en la figura fluye agua a 
                <input type="number" id="temperature" placeholder="Insertar T" min="32" max="212" style="width: 90px; height: 20px ;font-size: 16px;"> ¬∞F 
                    por una tuberia de hierro ductil revestida cuyos diametros son 
                    <input type="number" id="diametro_1" placeholder="diametro 1" min="3" max="25" style="width: 90px; height: 20px ;font-size: 16px;"> , 
                    <input type="number" id="diametro_2" placeholder="diametro 2" min="3" max="25" style="width: 90px; height: 20px ;font-size: 16px;"> y
                    <input type="number" id="diametro_3" placeholder="diametro 3" min="3" max="25" style="width: 90px; height: 20px ;font-size: 16px;"> pulgadas, con longitud igual a 
                    <input type="number" id="longitud_1" placeholder="longitud 1" min="0" style="width: 90px; height: 20px ;font-size: 16px;">,
                    <input type="number" id="longitud_2" placeholder="longitud 2" min="0" style="width: 90px; height: 20px ;font-size: 16px;">
                    y 
                    <input type="number" id="longitud_3" placeholder="longitud 3" min="0" style="width: 90px; height: 20px ;font-size: 16px;"> pies, respectivamente. 
                    Se sabe que el caudal es de <input type="number" id="caudal_ej1" placeholder="caudal" style="width: 90px; height: 20px ;font-size: 16px;"> gal/min. Determine la diferencia de altura entre los puntos A y B. Las contracciones son s√∫bitas.
                </p>

                <img src="d1.png" alt="Image" height="300" width="600">

                <label for="ans-0">Respuesta (ft):</label>
                <input type="text" id="ans-0" placeholder="Escribe la respuesta num√©rica">

                <div class="controls">
                    <button class="primary" data-action="check">Comprobar</button>
                    <button class="secondary" data-action="show-solution">Mostrar soluci√≥n</button>
                </div>

                <div class="feedback" id="fb-0" aria-live="polite"></div>
                <div class="solution" id="sol-0" style="display:none"></div>
            </section>

            <!-- Ejercicio 2 -->
            <section class="exercise" data-index="1" id="ex-1">
                <h2>Ejercicio 2</h2>
                <p>Para el sistema mostrado, fluye agua a 70¬∞F por tres tramos de tuber√≠a de hierro d√∫ctil revestida de di√°metros 3", 4" y 6", con longitudes 65, 110 y 185 ft, respectivamente. El caudal es 240.8 gal/min.</p>
                <img src="pag1.jpg" alt="Image" height="200" width="500">

                <label for="ans-1">Respuesta (ft):</label>
                <input type="text" id="ans-1" placeholder="Escribe la respuesta num√©rica">

                <div class="controls">
                    <button class="primary" data-action="check">Comprobar</button>
                    <button class="secondary" data-action="show-solution">Mostrar soluci√≥n</button>
                </div>

                <div class="feedback" id="fb-1"></div>
                <div class="solution" id="sol-1" style="display:none"></div>
                <div id="retro-1" class="retroalimentacion" style="display:none;"></div>
            </section>

            <!-- Ejercicio 3 -->
            <section class="exercise" data-index="2" id="ex-2">
                <h2>Ejercicio 3</h2>
                <p>Dos tuber√≠as iguales en serie tienen p√©rdidas h_each = 4 m cada una. ¬øCu√°l es la p√©rdida total?</p>

                <label for="ans-2">Respuesta (m):</label>
                <input type="text" id="ans-2" placeholder="Escribe la respuesta num√©rica">

                <div class="controls">
                    <button class="primary" data-action="check">Comprobar</button>
                    <button class="secondary" data-action="show-solution">Mostrar soluci√≥n</button>
                </div>

                <div class="feedback" id="fb-2"></div>
                <div class="solution" id="sol-2" style="display:none"></div>
            </section>

        </div>

        <div class="nav">
            <button id="prev">Anterior</button>
            <button id="next">Siguiente</button>
            <div style="flex:1"></div>
            <button id="reset">Reiniciar</button>
        </div>

    </div>

<script>
/* -------------------------
   TODAS las CONSTANTES
------------------------- */
const temperaturasSI = [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100];
const p_especificoSI = [9.81,9.81,9.81,9.81,9.79,9.78,9.77,9.75,9.73,9.71,9.69,9.67,9.65,9.62,9.59,9.56,9.53,9.50,9.47,9.44,9.40];
const densidadSI = [1000,1000,1000,1000,998,997,996,994,992,990,988,986,984,981,978,975,971,968,965,962,958];
const v_cinematicaSI = [1.75e-6,1.52e-6,1.30e-6,1.15e-6,1.02e-6,8.94e-7,8.03e-7,7.22e-7,6.56e-7,6.00e-7,5.48e-7,5.05e-7,4.67e-7,4.39e-7,4.11e-7,3.83e-7,3.60e-7,3.41e-7,3.22e-7,3.04e-7,2.94e-7];

const temperaturasIN = [32,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,212];
const p_especificoIN = [62.4,62.4,62.4,62.4,62.3,62.2,62.1,62.0,61.9,61.7,61.5,61.4,61.2,61.0,60.8,60.6,60.4,60.1,59.8];
const densidadIN = [1.94,1.94,1.94,1.94,1.94,1.93,1.93,1.93,1.92,1.92,1.91,1.91,1.90,1.90,1.89,1.88,1.88,1.87,1.86];
const v_cinematicaIN = [1.89e-5,1.67e-5,1.40e-5,1.21e-5,1.05e-5,9.15e-6,8.29e-6,7.37e-6,6.55e-6,5.94e-6,5.49e-6,5.03e-6,4.68e-6,4.38e-6,4.07e-6,3.84e-6,3.62e-6,3.35e-6,3.17e-6];

const g = 32.17;
const rug_HDR_IN = 0.0004;

const K_contraccion = {
  "2_pies_s":[0.00,0.03,0.07,0.17,0.26,0.34,0.38,0.40,0.42,0.44,0.47,0.48,0.49],
  "4_pies_s":[0.00,0.04,0.07,0.17,0.26,0.34,0.37,0.40,0.42,0.44,0.46,0.47,0.48],
  "6_pies_s":[0.00,0.04,0.07,0.17,0.26,0.34,0.37,0.39,0.41,0.43,0.45,0.47,0.48],
  "8_pies_s":[0.00,0.04,0.08,0.18,0.26,0.33,0.36,0.39,0.40,0.42,0.44,0.45,0.47],
  "10_pies_s":[0.00,0.05,0.08,0.18,0.26,0.33,0.36,0.38,0.40,0.42,0.45,0.46,0.47],
  "15_pies_s":[0.00,0.05,0.08,0.18,0.25,0.32,0.34,0.37,0.38,0.40,0.45,0.45,0.47],
  "20_pies_s":[0.00,0.05,0.09,0.18,0.25,0.31,0.33,0.35,0.37,0.39,0.46,0.47,0.47],
  "30_pies_s":[0.00,0.06,0.10,0.19,0.25,0.29,0.32,0.33,0.34,0.36,0.46,0.47,0.40],
  "40_pies_s":[0.00,0.06,0.11,0.20,0.24,0.27,0.29,0.30,0.31,0.33,0.38,0.40,0.38]
};

const claves = ["2_pies_s","4_pies_s","6_pies_s","8_pies_s","10_pies_s","15_pies_s","20_pies_s","30_pies_s","40_pies_s"];
const claves_value = [2,4,6,8,10,15,20,30,40];
const D1_D2 = [1.0,1.1,1.2,1.4,1.6,1.8,2.0,2.2,2.5,3.0,4.0,5.0,10.0];
let Za_correct = null;
/* -------------------------
   Funciones auxiliares
------------------------- */
function velocity(caudal, d1, d2, d3){
    let v1 = caudal*0.00222801 / (((d1/12)**2)*Math.PI/4);
    let v2 = caudal*0.00222801 / (((d2/12)**2)*Math.PI/4);
    let v3 = caudal*0.00222801 / (((d3/12)**2)*Math.PI/4);
    return {v1, v2, v3};
}

function subindice_inferior(lista, valor){
    if (valor < lista[0]) return 0;
    for (let i=0;i<lista.length;i++){
        if (lista[i] > valor) return i-1;
        if (lista[i] === valor) return i;
    }
    return lista.length - 1;
}

function subindice_superior(lista, valor){
    if (valor <= lista[0]) return 0;
    for (let i=0;i<lista.length;i++){
        if (lista[i] >= valor) return i;
    }
    return lista.length - 1;
}

function interpolacion(x0,y0,x1,y1,x){
    if (y0 === y1) return y0;
    return y0 + ((y1-y0)/(x1-x0))*(x-x0);
}

function factorf(d, Re){
    if (Re < 2000) return 64/Re;
    return 0.25 / (Math.log10(rug_HDR_IN/(3.7*(d/12)) + 5.74/(Re**0.9))**2);
}

function losses(f, L, v, d){
    return f * (L/(d/12)) * (v**2/(2*g));
}

function contractionlosses(k, v){
    return k*(v**2)/(2*g);
}

/* ---------------------------------------------------------
  FUNCI√ìN EJECUTAR EJERCICIO 1 
--------------------------------------------------------- */
function ejecutarEj1(){
    let Q_ej1 = parseFloat(document.getElementById('caudal_ej1').value);
    let d1 = parseFloat(document.getElementById('diametro_1').value);
    let d2 = parseFloat(document.getElementById('diametro_2').value);
    let d3 = parseFloat(document.getElementById('diametro_3').value);
    let T = parseFloat(document.getElementById('temperature').value);
    let L1 = parseFloat(document.getElementById('longitud_1').value);
    let L2 = parseFloat(document.getElementById('longitud_2').value);
    let L3 = parseFloat(document.getElementById('longitud_3').value);

    if (isNaN(Q_ej1)||isNaN(d1)||isNaN(d2)||isNaN(d3)||T<32||d1<d2||d2<d3){
        alert("Datos inv√°lidos.");
        return;
    }

    const velocidades = velocity(Q_ej1, d1, d2, d3);

    let si = subindice_inferior(temperaturasIN, T);
    let ss = subindice_superior(temperaturasIN, T);

    let vis_inf = v_cinematicaIN[si];
    let vis_sup = v_cinematicaIN[ss];
    let T_inf = temperaturasIN[si];
    let T_sup = temperaturasIN[ss];

    let visc;
    if (T_inf===T_sup) visc = vis_inf;
    else visc = vis_inf + ((vis_sup-vis_inf)/(T_sup-T_inf))*(T-T_inf);

    let r1 = d1/d2;
    let r2 = d2/d3;

    const v1 = velocidades.v1;
    const v2 = velocidades.v2;
    const v3 = velocidades.v3;

    let si_v2 = subindice_inferior(claves_value, v2);
    let ss_v2 = subindice_superior(claves_value, v2);

    let si_rA = subindice_inferior(D1_D2, r1);
    let ss_rA = subindice_superior(D1_D2, r1);

    let K1_i_i = K_contraccion[claves[si_v2]][si_rA];
    let K1_s_i = K_contraccion[claves[ss_v2]][ss_rA];

    let K1_i_d = K_contraccion[claves[Math.min(si_v2+1,claves.length-1)]][si_rA];
    let K1_s_d = K_contraccion[claves[Math.min(ss_v2+1,claves.length-1)]][ss_rA];

    let K1_inf = interpolacion(claves_value[si_v2],K1_i_i,claves_value[Math.min(si_v2+1,claves.length-1)],K1_i_d,v2);
    let K1_sup = interpolacion(claves_value[ss_v2],K1_s_i,claves_value[Math.min(ss_v2+1,claves.length-1)],K1_s_d,v2);
    let K1 = interpolacion(D1_D2[si_rA],K1_inf,D1_D2[ss_rA],K1_sup,r1);

    /* ---- K2 ---- */
    let si_v3 = subindice_inferior(claves_value, v3);
    let ss_v3 = subindice_superior(claves_value, v3);

    let si_rB = subindice_inferior(D1_D2, r2);
    let ss_rB = subindice_superior(D1_D2, r2);

    let K2_i_i = K_contraccion[claves[si_v3]][si_rB];
    let K2_s_i = K_contraccion[claves[ss_v3]][ss_rB];

    let K2_i_d = K_contraccion[claves[Math.min(si_v3+1,claves.length-1)]][si_rB];
    let K2_s_d = K_contraccion[claves[Math.min(ss_v3+1,claves.length-1)]][ss_rB];

    let K2_inf = interpolacion(claves_value[si_v3],K2_i_i,claves_value[Math.min(si_v3+1,claves.length-1)],K2_i_d,v3);
    let K2_sup = interpolacion(claves_value[ss_v3],K2_s_i,claves_value[Math.min(ss_v3+1,claves.length-1)],K2_s_d,v3);
    let K2 = interpolacion(D1_D2[si_rB],K2_inf,D1_D2[ss_rB],K2_sup,r2);

    let Re1 = v1*(d1/12)/visc;
    let Re2 = v2*(d2/12)/visc;
    let Re3 = v3*(d3/12)/visc;

    let f1 = factorf(d1, Re1);
    let f2 = factorf(d2, Re2);
    let f3 = factorf(d3, Re3);

    let h1 = losses(f1, L1, v1, d1);
    let h2 = losses(f2, L2, v2, d2);
    let h3 = losses(f3, L3, v3, d3);

    let hc1 = contractionlosses(K1, v2);
    let hc2 = contractionlosses(K2, v3);

    let hvB = (v3**2)/(2*g);

    Za_correct = h1 + h2 + h3 + hvB + hc1 + hc2;

    alert(`Velocidades:\nv1=${v1.toFixed(2)}\nv2=${v2.toFixed(2)}\nv3=${v3.toFixed(2)}
Viscosidad=${visc}
K1=${K1}
K2=${K2}
f1=${f1}
f2=${f2}
f3=${f3}
P√©rdidas rectas: h1=${h1}, h2=${h2}, h3=${h3}
P√©rdidas menores: hc1=${hc1}, hc2=${hc2}
Za = ${Za_correct}`);
}

/* -------------------------
   PROBLEMAS Y CHECKEO
------------------------- */
let problems = [
    { answer: ()=>Za_correct, solution: "Suma de p√©rdidas por tramos rectos, por contracciones s√∫bitas y la carga de velocidad en B." }, 
    { answer: ()=>21.92,     solution: "zA - zB = 21.92 ft." },
    { answer: ()=>8,         solution: "h_total = 8 m" }
];

/* -------------------------
   Navegaci√≥n
------------------------- */
let current = 0;    
const exerciseEls = document.querySelectorAll('.exercise');

function showExercise(i){
    exerciseEls.forEach((el,idx)=>el.classList.toggle("active", idx===i));
    current = i;
}

document.getElementById("prev").onclick = () => showExercise(Math.max(0,current-1));
document.getElementById("next").onclick = () => showExercise(Math.min(exerciseEls.length-1,current+1));

document.getElementById("reset").onclick = () => {
    for(let i=0;i<exerciseEls.length;i++){
        document.getElementById("ans-"+i).value="";
        document.getElementById("fb-"+i).textContent="";
        document.getElementById("sol-"+i).style.display="none";
        let r = document.getElementById("retro-"+i);
        if(r) r.style.display="none";
    }
    showExercise(0);
};

/* -------------------------
   Eventos de botones
------------------------- */
document.getElementById("exercises").addEventListener("click", e=>{
    let action = e.target.getAttribute("data-action");
    if (!action) return;

    let section = e.target.closest(".exercise");
    let idx = Number(section.dataset.index);

    if (idx === 0 && action === "check") {
        ejecutarEj1();  // üîµ el bot√≥n azul ejecuta c√°lculo del Ej1
    }

    if (action === "check") checkAnswer(idx);
    if (action === "show-solution") showSolution(idx);
});

function normalizeNumberInput(v){
    return Number(String(v).trim().replace(",","."));
}

function checkAnswer(i){
    let input = document.getElementById("ans-"+i);
    let fb = document.getElementById("fb-"+i);
    let sol = document.getElementById("sol-"+i);

    let val = normalizeNumberInput(input.value);

    let correct = (typeof problems[i].answer === "function")
                    ? problems[i].answer()
                    : problems[i].answer;

    if (isNaN(val)){
        fb.textContent="N√∫mero inv√°lido.";
        fb.className="feedback error";
        return;
    }

    let errorPermitido = 0.05; // 5%

    if (Math.abs(val - correct) <= Math.abs(correct)*errorPermitido){
        fb.textContent="Correcto ‚úî";
        fb.className="feedback success";
        sol.style.display="none";
    } else {
        fb.textContent="Incorrecto ‚úò";
        fb.className="feedback error";
        sol.textContent = `Soluci√≥n: ${correct.toFixed(3)}\n${problems[i].solution}`;
        sol.style.display="block";
    }
}
function showSolution(i){
    let sol = document.getElementById("sol-"+i);
    sol.textContent = problems[i].solution;
    sol.style.display="block";
}

</script>
</body>
</html>
